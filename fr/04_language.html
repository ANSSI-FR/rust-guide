<!DOCTYPE HTML>
<html lang="fr" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Généralités sur le langage - Développement sécurisé en Rust</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Recommandations pour le développement d&#x27;applications sécurisées en Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01_introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="02_devenv.html"><strong aria-hidden="true">2.</strong> Environnement de développement</a></li><li class="chapter-item expanded "><a href="03_libraries.html"><strong aria-hidden="true">3.</strong> Bibliothèques</a></li><li class="chapter-item expanded "><a href="04_language.html" class="active"><strong aria-hidden="true">4.</strong> Généralités sur le langage</a></li><li class="chapter-item expanded "><a href="05_memory.html"><strong aria-hidden="true">5.</strong> Gestion de la mémoire</a></li><li class="chapter-item expanded "><a href="06_typesystem.html"><strong aria-hidden="true">6.</strong> Système de types</a></li><li class="chapter-item expanded "><a href="07_ffi.html"><strong aria-hidden="true">7.</strong> FFI</a></li><li class="chapter-item expanded affix "><a href="LICENSE.html">License</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Développement sécurisé en Rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="généralités-sur-le-langage"><a class="header" href="#généralités-sur-le-langage">Généralités sur le langage</a></h1>
<h2 id="nommage"><a class="header" href="#nommage">Nommage</a></h2>
<p>La convention de nommage employée par la bibliothèque standard est <em>de facto</em> le
standard pour le nommage des éléments des programmes écrits en Rust. Un effort a
été fait pour formaliser ces conventions de nommage, d'abord dans la <a href="https://github.com/rust-lang/rfcs/blob/master/text/0430-finalizing-naming-conventions.md">RFC 430</a>,
puis dans le document des <em><a href="https://rust-lang.github.io/api-guidelines/">Rust API Guidelines</a></em>.</p>
<p>La règle de base consiste à utiliser :</p>
<ul>
<li><code>UpperCamelCase</code> pour les types, traits et valeurs d'énumérations ;</li>
<li><code>snake_case</code> pour les fonctions, méthodes, macros, variables et modules ;</li>
<li><code>SCREAMING_SNAKE_CASE</code> pour les variables statiques et les constantes ;</li>
<li><code>'lowercase</code> pour les durées de vie (<em>lifetimes</em>).</li>
</ul>
<p>Les <a href="https://rust-lang.github.io/api-guidelines/">Rust API Guidelines</a> recommandent également des conventions de nommage
plus précises pour certaines constructions particulières :</p>
<ul>
<li>(C-CONV) pour les méthodes de conversion (<code>as_</code>, <code>to_</code>, <code>into_</code>) ;</li>
<li>(C-GETTER) pour les accesseurs ;</li>
<li>(C-ITER) pour les méthodes produisant des itérateurs ;</li>
<li>(C-ITER-TY) pour les types itérateur ;</li>
<li>(C-FEATURE) pour les noms de <em>features</em> ;</li>
<li>(C-WORD-ORDER) pour la cohérence sur l'ordre des mots.</li>
</ul>
<blockquote>
<h3 id="règle-lang-naming"><a class="header" href="#règle-lang-naming">Règle <a id="LANG-NAMING"></a>LANG-NAMING</a></h3>
<p>Le développement d'une application sécurisée doit suivre les conventions de
nommage décrites dans les <a href="https://rust-lang.github.io/api-guidelines/">Rust API Guidelines</a>.</p>
</blockquote>
<h2 id="code-unsafe"><a class="header" href="#code-unsafe">Code <em>unsafe</em></a></h2>
<p>L'utilisation conjointe du système de types et du système d'<em>ownership</em> vise à
apporter un haut niveau de sûreté quant à la gestion de la mémoire dans les
programmes écrits en Rust. Le langage permet alors d'éviter les débordements
mémoire, la construction de pointeurs nuls ou invalides, et les problèmes
d'accès concurrents à la mémoire.
Pour effectuer des actions considérées risquées comme des appels système, des
conversions de types ou la manipulation directe de pointeurs mémoire, le
langage fournit le mot-clé <code>unsafe</code>.</p>
<blockquote>
<h3 id="règle-lang-unsafe"><a class="header" href="#règle-lang-unsafe">Règle <a id="LANG-UNSAFE"></a>LANG-UNSAFE</a></h3>
<p>Pour un développement sécurisé, les blocs <code>unsafe</code> doivent être évités.
Ci-dessous, nous listons les seuls cas pour lesquels des blocs <code>unsafe</code>
peuvent être utilisés, à la condition que leur usage soit justifié :</p>
<ul>
<li>
<p>L'interfaçage entre Rust et d'autres langages (FFI) permet la déclaration
de fonctions dont l'implantation est faite en C, en utilisant le préfixe
<code>extern &quot;C&quot;</code>. Pour utiliser une telle fonction, le mot-clé <code>unsafe</code> est
requis. Un <em>wrapper</em> &quot;sûr&quot; doit être défini pour que le code C soit
finalement appelé de façon souple et sûre.</p>
</li>
<li>
<p>Pour la programmation des systèmes embarqués, on accède souvent aux
registres et à d'autres ressources au travers d'adresses mémoire fixées
Dans ce cas, des blocs <code>unsafe</code> sont nécessaires afin de pouvoir initialiser
et déréférencer des pointeurs en Rust pour ces adresses. Afin de minimiser le
nombre de déclarations <code>unsafe</code> pour permettre au développeur de facilement
identifier les accès critiques, une abstraction adaptée (structure de
données ou module) doit être mise en place.</p>
</li>
<li>
<p>Une fonction peut être marquée globalement comme non sûre (en préfixant sa
déclaration par le mot-clé <code>unsafe</code>) lorsqu'elle exhibe inévitablement des
comportements non sûrs en fonction de ses arguments. Par exemple, cela arrive
lorsqu'une fonction doit déréférencer un pointeur passé en argument.</p>
</li>
</ul>
<p>À l'exception de l'un ou plusieurs de ces cas <code>#![forbid(unsafe_code)]</code> doit
apparaître dans à la racine de la <em>crate</em> (typiquement <code>main.rs</code> ou <code>lib.rs</code>)
afin de générer des erreurs de compilation dans le cas ou le mot-clé <code>unsafe</code>
est utilisé dans le projet.</p>
</blockquote>
<h2 id="dépassement-dentiers"><a class="header" href="#dépassement-dentiers">Dépassement d'entiers</a></h2>
<p>Bien que des vérifications soient effectuées par Rust en ce qui concerne les
potentiels dépassements d'entiers, des précautions doivent être prises lors de
l'exécution d'opérations arithmétiques sur les entiers.</p>
<p>En particulier, il doit être noté que les profils de compilation <em>debug</em> et
<em>release</em> produisent des variations de comportements quant à la gestion des
dépassements d'entiers. Dans la configuration <em>debug</em>, un dépassement provoque
la terminaison du programme (<code>panic</code>), tandis que dans la configuration
<em>release</em> la valeur calculée est silencieusement tronquée en fonction de la
valeur maximum qui peut être stockée pour le type considéré.</p>
<p>Ce comportement peut être rendu explicite en utilisant le type générique
<code>Wrapping</code>, ou les opérations sur les entiers <code>overflowing_&lt;op&gt;</code> et
<code>wrapping_&lt;op&gt;</code> (la partie <code>&lt;op&gt;</code> étant remplacée par le type de calcul :
<code>add</code>, <code>mul</code>, <code>sub</code>, <code>shr</code>, etc.).</p>
<pre><pre class="playground"><code class="language-rust">use std::num::Wrapping;
<span class="boring">use std::panic;
</span>
<span class="boring">fn main() {
</span>let x: u8 = 242;

<span class="boring">let result = panic::catch_unwind(|| {
</span>println!(&quot;{}&quot;, x + 50);                      // panique en mode debug, affiche 36 en mode release.
<span class="boring">});
</span><span class="boring">if result.is_err() { println!(&quot;panic&quot;); }
</span>println!(&quot;{}&quot;, x.overflowing_add(50).0);     // affiche toujours 36.
println!(&quot;{}&quot;, x.wrapping_add(50));          // affiche toujours 36.
println!(&quot;{}&quot;, Wrapping(x) + Wrapping(50));  // affiche toujours 36.

// panique toujours :
let (res, c) = x.overflowing_add(50);
<span class="boring">let result = panic::catch_unwind(|| {
</span>if c { panic!(&quot;custom error&quot;); }
else { println!(&quot;{}&quot;, res); }
<span class="boring">});
</span><span class="boring">if result.is_err() { println!(&quot;panic&quot;); }
</span><span class="boring">}
</span></code></pre></pre>
<blockquote>
<h3 id="règle-lang-arith"><a class="header" href="#règle-lang-arith">Règle <a id="LANG-ARITH"></a>LANG-ARITH</a></h3>
<p>Lorsqu'une opération arithmétique peut produire un dépassement d'entier, les
fonctions spécialisées <code>overflowing_&lt;op&gt;</code>, <code>wrapping_&lt;op&gt;</code> ou le type
<code>Wrapping</code> doivent être utilisés.</p>
</blockquote>
<h2 id="gestion-des-erreurs"><a class="header" href="#gestion-des-erreurs">Gestion des erreurs</a></h2>
<!--
<mark>TODO</mark>: décrire les bonnes pratiques de gestion d'erreurs.
-->
<p>Le type <code>Result</code> est la façon privilégiée en Rust pour décrire le type de retour
des fonctions dont le traitement peut échouer. Un objet <code>Result</code> doit être
testé et jamais ignoré.</p>
<blockquote>
<h3 id="recommandation-lang-errwrap"><a class="header" href="#recommandation-lang-errwrap">Recommandation <a id="LANG-ERRWRAP"></a>LANG-ERRWRAP</a></h3>
<p>Une <em>crate</em> peut implanter son propre type <code>Error</code> qui peut contenir toutes
les erreurs possibles. Des précautions supplémentaires doivent être prises :
ce type doit être <em>exception-safe</em> (RFC 1236) et implémenter les traits
<code>Error + Send + Sync + 'static</code> ainsi que <code>Display</code>.</p>
</blockquote>
<blockquote>
<h3 id="recommandation-lang-errdo"><a class="header" href="#recommandation-lang-errdo">Recommandation <a id="LANG-ERRDO"></a>LANG-ERRDO</a></h3>
<p>L'opérateur <code>?</code> doit être utilisé pour améliorer la lisibilité du code.
La macro <code>try!</code> ne doit pas être utilisée.</p>
</blockquote>
<p>Des <em>crates</em> tierces peuvent être utilisées pour faciliter la gestion d'erreurs.
La plupart (<a href="https://crates.io/crates/failure">failure</a>, <a href="https://crates.io/crates/snafu">snafu</a>, <a href="https://crates.io/crates/thiserror">thiserror</a>) proposent la création de types
d'erreurs personnalisées qui implémentent les traits nécessaires et permettent
l'encapsulation d'autres erreurs.</p>
<p>Une autre approche (notamment proposée dans <a href="https://crates.io/crates/anyhow">anyhow</a>) consiste à envelopper
automatiquement les erreurs dans un seul type d'erreur universel. Une telle
approche ne devrait pas être utilisée dans des bibliothèques ou des systèmes
complexes parce qu'elle ne permet pas de fournir de contexte sur les erreurs
ainsi initialement enveloppées, contrairement à la première approche.</p>
<h3 id="panics"><a class="header" href="#panics"><em>Panics</em></a></h3>
<p>La gestion explicite des erreurs (<code>Result</code>) doit être préférée à la place de
l'utilisation de la macro <code>panic</code>. La cause de l'erreur doit être rendue
disponible, et les erreurs trop génériques doivent être évitées.</p>
<p>Les <em>crates</em> fournissant des bibliothèques ne doivent pas utiliser de fonctions
ou d'instructions qui peuvent échouer en engendrant un <code>panic</code>.</p>
<p>Des motifs courants de code qui provoquent des <code>panic</code> sont :</p>
<ul>
<li>une utilisation de <code>unwrap</code> ou de <code>expect</code> ;</li>
<li>une utilisation de <code>assert</code> ;</li>
<li>un accès non vérifié à un tableau ;</li>
<li>un dépassement d'entier (en mode <em>debug</em>) ;</li>
<li>une division par zéro ;</li>
<li>l'utilisation de <code>format!</code> pour le formatage d'une chaîne de caractères.</li>
</ul>
<blockquote>
<h3 id="règle-lang-nopanic"><a class="header" href="#règle-lang-nopanic">Règle <a id="LANG-NOPANIC"></a>LANG-NOPANIC</a></h3>
<p>Les fonctions et instructions qui peuvent causer des <code>panic</code> à l'exécution
ne doivent pas être utilisées.</p>
</blockquote>
<blockquote>
<h3 id="règle-lang-arrindexing"><a class="header" href="#règle-lang-arrindexing">Règle <a id="LANG-ARRINDEXING"></a>LANG-ARRINDEXING</a></h3>
<p>L'indice d'accès à un tableau doit être testé, ou la méthode <code>get</code> doit être
utilisée pour récupérer une <code>Option</code>.</p>
</blockquote>
<!--
<mark>TODO</mark> Vérifier si la crate *[no_panic](https://github.com/dtolnay/no-panic)*
peut détecter tous les cas. Inconvénient : toutes les fonctions doivent être
marquées avec `#[no_panic]`.
-->
<!--
<mark>TODO</mark> Another possibility:
[rustig](https://github.com/Technolution/rustig) (doesn't build here)
-->
<h3 id="ffi-et-panics"><a class="header" href="#ffi-et-panics">FFI et <code>panic</code>s</a></h3>
<p>Lorsque du code Rust est appelé depuis du code écrit dans un autre
langage (par exemple, du code C), le code Rust doit être écrit de sorte à ne
jamais pouvoir paniquer.
Dérouler (<em>unwinding</em>) depuis le code Rust vers le code étranger résulte en un
comportement indéfini.</p>
<blockquote>
<h3 id="règle-lang-ffipanic"><a class="header" href="#règle-lang-ffipanic">Règle <a id="LANG-FFIPANIC"></a>LANG-FFIPANIC</a></h3>
<p>Le code Rust appelé depuis une FFI doit soit être assuré de ne pas paniquer,
soit utiliser <code>catch_unwind</code> ou le module <code>std::panic</code> pour s'assurer qu'il
ne va pas abandonner un traitement puis que l'exécution retourne dans le
langage appelant dans un état instable.</p>
</blockquote>
<p>Il est porté à l'attention du développeur que <code>catch_unwind</code> ne va traiter que
les cas de <code>panic</code>, et va préserver les abandons de processus causés par
d'autres raisons.</p>
<!-- ## Macros -->
<!--
<mark>TODO</mark> : complexité cyclomatique du code macro-expansé, limites de
récursion, ...
-->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="03_libraries.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="05_memory.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="03_libraries.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="05_memory.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
